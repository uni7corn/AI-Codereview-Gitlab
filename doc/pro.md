# AI Codereview Proç‰ˆ

åŠŸèƒ½æ›´åŠ ä¸°å¯Œå¼ºå¤§çš„Code Reviewã€é¡¹ç›®ç®¡ç†å·¥å…·

## åŠŸèƒ½è¯´æ˜

### ğŸ¯æ›´ä¸°å¯Œã€å‹å¥½å¯è§†åŒ–çœ‹æ¿

**å¤šç»´æ•°æ®çœ‹æ¿ï¼š** æä¾›ä¸°å¯Œã€ç›´è§‚çš„å¯è§†åŒ–ç•Œé¢ï¼Œæ‰“é€ å›¢é˜Ÿä¸“å±çš„æ•ˆèƒ½æ´å¯Ÿä¸­å¿ƒ

### âš™ï¸ æ™ºèƒ½è¯„å®¡å¼•æ“

**çµæ´»è§¦å‘æœºåˆ¶ï¼š** æ”¯æŒæŒ‰é¡¹ç›®è‡ªå®šä¹‰ä»£ç è¯„å®¡è§¦å‘è§„åˆ™ï¼ˆMerge Request æˆ– Push äº‹ä»¶ï¼‰ï¼Œé€‚é…å¤šæ ·åŒ–ç ”å‘æµç¨‹ã€‚

**å¤§æ¨¡å‹é›†æˆä¸­å¿ƒï¼š** æä¾›ç»Ÿä¸€çš„å¯è§†åŒ–ç•Œé¢ï¼Œä¾¿æ·é›†æˆä¸ç®¡ç†å¤šæ¬¾ä¸»æµå¤§è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰ï¼Œæ‰“é€ ä¼ä¸šä¸“å±AIèƒ½åŠ›çŸ©é˜µ

### ğŸ¤– æ™ºèƒ½é€šçŸ¥ä½“ç³»

**å…¨æ¸ é“æœºå™¨äººä¸­å¿ƒï¼š** ä¸€ç«™å¼ç®¡ç†é’‰é’‰ã€é£ä¹¦ã€ä¼ä¸šå¾®ä¿¡ç­‰å¹³å°é€šçŸ¥æœºå™¨äººï¼Œæ”¯æŒå„é¡¹ç›®ç‹¬ç«‹ç»‘å®šä¸æ¶ˆæ¯æ¨¡æ¿å®šåˆ¶

**ç²¾å‡†ä¿¡æ¯è§¦è¾¾ï¼š** å®ç°å…³é”®ä¿¡æ¯çš„æ™ºèƒ½åŒ–åˆ†å‘ä¸ç²¾å‡†æ¨é€ï¼Œæå‡å›¢é˜ŸååŒæ•ˆç‡

### ğŸ¨ å¼€å‘è€…ä½“éªŒä¼˜åŒ–

**åŒä¸»é¢˜è§†è§‰ç³»ç»Ÿï¼š** æä¾›å®Œæ•´çš„æµ…è‰²ï¼ˆLightï¼‰ä¸æ·±è‰²ï¼ˆDarkï¼‰ä¸»é¢˜æ¨¡å¼ï¼Œæ»¡è¶³ä¸åŒåœºæ™¯ä¸‹çš„è§†è§‰åå¥½

### ğŸ“Š æ·±åº¦åˆ†æä¸æ´å¯Ÿ

**æˆå‘˜æ•ˆèƒ½åˆ†æï¼š** å¤šç»´å¯¹æ¯”å›¢é˜Ÿæˆå‘˜æäº¤è¡Œä¸ºä¸è´¡çŒ®åº¦ï¼Œé‡åŒ–è¯„ä¼°ç ”å‘æ•ˆèƒ½

**Deep Reviewæ™ºèƒ½åˆ†æï¼š** é€šè¿‡è‡ªç„¶è¯­è¨€ä¸é¡¹ç›®æ·±åº¦äº¤äº’ï¼Œè·å–ä»£ç åº“æ•´ä½“æ¶æ„ä¸è´¨é‡æ´å¯Ÿ

**é¡¹ç›®å“¨å…µç³»ç»Ÿï¼š** å®šæ—¶è‡ªåŠ¨åŒ–åˆ†æé¡¹ç›®å¥åº·çŠ¶æ€ï¼Œç”Ÿæˆç»“æ„åŒ–æŠ¥å‘Šå¹¶æ¨é€è‡³æŒ‡å®šæ¸ é“ï¼Œå®ç°é¡¹ç›®çŠ¶æ€çš„å¯è§†åŒ–è¿½è¸ªä¸é¢„è­¦


**å¤šç§ç»Ÿè®¡å›¾**
![Dashboard](img/pro/dashboard.png)

**æˆå‘˜æäº¤åˆ†æ** 
![Dashboard](img/pro/member-analysis.png)

**Deep Review** 
![Dashboard](img/pro/deepreview.png)

**é¡¹ç›®å“¨å…µ** 
![Dashboard](img/pro/project-analysis-plan.png)

## ä½“éªŒç«™

åœ°å€: [https://demo.mzfuture.com](https://demo.mzfuture.com)

## éƒ¨ç½²

### 1. å‡†å¤‡ç¯å¢ƒ
- åˆ›å»ºç›®å½•
```aiignore
mkdir -p {data,logs}
```

- ä¸€èˆ¬åœºæ™¯ï¼ˆæ¨èï¼‰ï¼šåˆ›å»ºdocker-compose.ymlæ–‡ä»¶

```yaml
services:
  mysql:
    image: mysql:8.0.44
    container_name: codereview-mysql
    environment:
      MYSQL_ROOT_PASSWORD: u9QdPyXM
      MYSQL_DATABASE: codereview
      TZ: Asia/Shanghai
    command:
      --character-set-server=utf8mb4
      --collation-server=utf8mb4_general_ci
      --explicit_defaults_for_timestamp=1
      --lower_case_table_names=1
    volumes:
      - ./data/mysql:/var/lib/mysql
    healthcheck:
      test: ["CMD", "mysqladmin", "ping", "-h", "localhost", "-pu9QdPyXM"]
      interval: 5s
      timeout: 3s
      retries: 10
      start_period: 30s
    restart: unless-stopped

  app:
    image: registry.cn-hangzhou.aliyuncs.com/stanley-public/ai-codereview-pro:1.3.1
    container_name: codereview-app
    ports:
      - "81:80"
    environment:
      APP_USERNAME: admin
      APP_PASSWORD: admin
      DB_HOST: mysql
      DB_PORT: 3306
      DB_NAME: codereview
      DB_USERNAME: root
      DB_PASSWORD: u9QdPyXM
      TZ: Asia/Shanghai
    volumes:
      - ./data:/app/data
      - ./logs:/app/logs
    depends_on:
      mysql:
        condition: service_healthy
    restart: unless-stopped
```
- ç‰¹æ®Šåœºæ™¯ åˆ›å»ºdocker-compose.ymlæ–‡ä»¶ï¼ˆé€‚ç”¨å­˜åœ¨2çº§è·¯ç”±ï¼Œä¾‹å¦‚ä½ çš„gitlabä¸»ç«™åŸŸåä¸ºx.x.com/gitlabï¼‰ï¼š
- åŸç†ï¼šé€šè¿‡nginxåŠ«æŒai-codereview-proåº”ç”¨çš„è®¿é—®ï¼Œå¼ºè¡ŒåŠ å…¥/gitlab
```
services:
  mysql:
    image: mysql:8.0
    container_name: codereview-mysql
    privileged: true
    environment:
      MYSQL_ROOT_PASSWORD: u9QdPyXM
      MYSQL_DATABASE: codereview
      TZ: Asia/Shanghai
    command:
      - --character-set-server=utf8mb4
      - --collation-server=utf8mb4_general_ci
    volumes:
      - ./data/mysql:/var/lib/mysql
    restart: unless-stopped
    networks:
      - internal
  app:
    image: registry.cn-hangzhou.aliyuncs.com/stanley-public/ai-codereview-pro:1.3.1
    container_name: codereview-app
    privileged: true
    ports:
      - "81:80"
    environment:
      APP_USERNAME: admin
      APP_PASSWORD: admin
      DB_HOST: mysql
      DB_PORT: 3306
      DB_NAME: codereview
      DB_USERNAME: root
      DB_PASSWORD: u9QdPyXM
    volumes:
      - ./data:/app/data
      - ./logs:/app/logs
    depends_on:
      - mysql
    restart: unless-stopped
    networks:
      - internal
  proxy:
    image: nginx:1.29.3-alpine3.22-slim
    container_name: codereview-proxy
    volumes:
      - ./nginx.conf:/etc/nginx/nginx.conf:ro
      - ./certs:/etc/nginx/certs:ro
    ports:
      - "443:443"
    restart: unless-stopped
    networks:
      internal:
        aliases:
          - x.x.com
networks:
  internal:
    driver: bridge

```
ç‰¹æ®Šåœºæ™¯ ä¸­çš„nginx.conf

```
events {}
http {
    upstream real_gitlab {
        # æŠŠ <REAL_IP> æ¢æˆ x.x.com çš„çœŸå®åœ°å€
        server 192.168.1.2:443;
    }

    server {
        listen 443 ssl;
        server_name x.x.com;

        ssl_certificate     /etc/nginx/certs/server.crt;
        ssl_certificate_key /etc/nginx/certs/server.key;

        location / {
            # ç»Ÿä¸€åŠ  /gitlab å‰ç¼€
            rewrite ^(.*)$ /gitlab$1 break;

            proxy_pass https://real_gitlab;
            proxy_ssl_verify        off;   # è‡ªç­¾/å†…ç½‘å¿…éœ€
            proxy_ssl_server_name   on;
            proxy_set_header Host   x.x.com;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_connect_timeout   10s;
        }
    }
}
```

### 2. å¯åŠ¨æœåŠ¡
```bash
docker-compose up -d
```

### 3. è®¿é—®ç®¡ç†åå°
æ‰“å¼€æµè§ˆå™¨ï¼Œè®¿é—® http://localhost:81 ï¼Œä½¿ç”¨ç”¨æˆ·å `admin` å’Œå¯†ç  `admin` ç™»å½•ã€‚

### 4. ç³»ç»Ÿé…ç½®

æŒ‰ç…§å®é™…æƒ…å†µï¼Œåœ¨ç³»ç»Ÿå†…å¢åŠ é¡¹ç›®ã€å¤§æ¨¡å‹ã€é€šçŸ¥æœºå™¨äººç­‰ä¿¡æ¯ã€‚

## é…ç½®ä»£ç åº“ Webhook (ä»¥Gitlabä¸ºä¾‹)

### 1. åˆ›å»ºAccess Token

æ–¹æ³•ä¸€ï¼šåœ¨ GitLab ä¸ªäººè®¾ç½®ä¸­ï¼Œåˆ›å»ºä¸€ä¸ª Personal Access Tokenã€‚

æ–¹æ³•äºŒï¼šåœ¨ GitLab é¡¹ç›®è®¾ç½®ä¸­ï¼Œåˆ›å»ºProject Access Token

### 2. é…ç½® Webhook

åœ¨ GitLab é¡¹ç›®è®¾ç½®ä¸­ï¼Œé…ç½® Webhookï¼š

- URLï¼šhttp://your-server-ip:81/review/webhook
- Trigger Eventsï¼šå‹¾é€‰ Push Events å’Œ Merge Request Events (ä¸è¦å‹¾é€‰å…¶å®ƒEvent)
- Secret Tokenï¼šä¸Šé¢é…ç½®çš„ Access Token(å¯é€‰)

### 3. æµ‹è¯• Webhook

åœ¨Gitlab Webhooké…ç½®é¡µé¢, é€‰æ‹©"Test" -> "Push Events"

### åˆ°ç®¡ç†åå°æŸ¥çœ‹ç»“æœ
